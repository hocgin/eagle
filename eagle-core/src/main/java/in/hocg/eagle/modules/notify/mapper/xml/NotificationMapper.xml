<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="in.hocg.eagle.modules.notify.mapper.NotificationMapper">

    <select id="search" resultType="in.hocg.eagle.modules.notify.entity.Notification">
        SELECT tn.* FROM t_notification tn
        LEFT JOIN t_notify t on tn.notify_id = t.id
        <where>
            <if test="qo.receiverId != null">
                AND tn.receiver_id = #{qo.receiverId}
            </if>
        </where>
    </select>
    <update id="updateReadyAtNowByNotifyId">
        UPDATE t_notification
        SET read_at = NOW()
        WHERE notify_id = #{notifyId}
          AND receiver_id = #{receiverId}
    </update>
    <select id="selectListByReceiverIdAndNotifyType"
            resultType="in.hocg.eagle.modules.notify.entity.Notification">
        SELECT tn.*
        FROM t_notification tn
        LEFT JOIN t_notify tn2 on tn.notify_id = tn2.id
        WHERE tn.receiver_id = #{accountId}
        <choose>
            <!--订阅方式-->
            <when test="notifyType == 2">
                AND tn2.notify_type NOT IN(0, 1)
            </when>
            <otherwise>
                AND tn2.notify_type = #{notifyType}
            </otherwise>
        </choose>
        LIMIT 0,#{topNumber}
    </select>
</mapper>
